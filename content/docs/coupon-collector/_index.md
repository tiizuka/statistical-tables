---
title: クーポンコレクター問題
---

### $k$ 種類のクーポンが全種類揃う回数の期待値

$k$ 種類の等確率の選択肢を $n$ 回引くとき、全種類が揃う回数 $n$ の期待値 E($n$)

$$ {\rm E}(n) \medspace = \medspace k \thinspace H(k) $$

$H(n)$ は 調和数 ([wikipedia](https://ja.wikipedia.org/wiki/%E8%AA%BF%E5%92%8C%E6%95%B0_(%E7%99%BA%E6%95%A3%E5%88%97))) です。

|   種類数(k) |   全種類揃う回数の期待値(E) |   種類数あたりの回数の期待値(E/k) |
|---------:|-----------------:|---------------------:|
|        3 |          5.5     |              1.83333 |
|        5 |         11.4167  |              2.28333 |
|       10 |         29.2897  |              2.92897 |
|       20 |         71.9548  |              3.59774 |
|       30 |        119.85    |              3.99499 |
|       50 |        224.96    |              4.49921 |
|      100 |        518.738   |              5.18738 |
|      300 |       1884.8     |              6.28266 |
|     1000 |       7485.47    |              7.48547 |

約10で3倍、約30で4倍、約80で5倍です。

近似式
[wikipedia](https://ja.wikipedia.org/wiki/%E3%82%AF%E3%83%BC%E3%83%9D%E3%83%B3%E3%82%B3%E3%83%AC%E3%82%AF%E3%82%BF%E3%83%BC%E5%95%8F%E9%A1%8C)

$$ {\rm E}(n) \medspace = \medspace k \log k + \gamma \thinspace k + \frac{1}{2} + O(1/k) $$

ここで、$\gamma \approx 0.5772156649$ はオイラーの定数


pythonでSymPyを使用して計算するコード例です。

```python
from sympy import harmonic
import tabulate

rk = list(range(1, 100+1)) + list(range(105, 200+1, 5)) + list(range(210, 500+1, 10)) + list(range(550, 1000+1, 50))
f = lambda k: k * harmonic(k)
table = [ [ k, f(k), f(k)/k ] for k in rk ]
headers = [ '種類数(k)', '全種類揃う回数の期待値(E)', '種類数あたりの回数の期待値(E/k)' ]
print(tabulate.tabulate( table, headers, tablefmt="pipe" ))
```

|   種類数(k) |   全種類揃う回数の期待値(E) |   種類数あたりの回数の期待値(E/k) |
|---------:|-----------------:|---------------------:|
|        1 |          1       |              1       |
|        2 |          3       |              1.5     |
|        3 |          5.5     |              1.83333 |
|        4 |          8.33333 |              2.08333 |
|        5 |         11.4167  |              2.28333 |
|        6 |         14.7     |              2.45    |
|        7 |         18.15    |              2.59286 |
|        8 |         21.7429  |              2.71786 |
|        9 |         25.4607  |              2.82897 |
|       10 |         29.2897  |              2.92897 |
|       11 |         33.2187  |              3.01988 |
|       12 |         37.2385  |              3.10321 |
|       13 |         41.3417  |              3.18013 |
|       14 |         45.5219  |              3.25156 |
|       15 |         49.7734  |              3.31823 |
|       16 |         54.0917  |              3.38073 |
|       17 |         58.4724  |              3.43955 |
|       18 |         62.9119  |              3.49511 |
|       19 |         67.4071  |              3.54774 |
|       20 |         71.9548  |              3.59774 |
|       21 |         76.5525  |              3.64536 |
|       22 |         81.1979  |              3.69081 |
|       23 |         85.8887  |              3.73429 |
|       24 |         90.623   |              3.77596 |
|       25 |         95.399   |              3.81596 |
|       26 |        100.215   |              3.85442 |
|       27 |        105.069   |              3.89146 |
|       28 |        109.961   |              3.92717 |
|       29 |        114.888   |              3.96165 |
|       30 |        119.85    |              3.99499 |
|       31 |        124.845   |              4.02725 |
|       32 |        129.872   |              4.0585  |
|       33 |        134.93    |              4.0888  |
|       34 |        140.019   |              4.11821 |
|       35 |        145.137   |              4.14678 |
|       36 |        150.284   |              4.17456 |
|       37 |        155.459   |              4.20159 |
|       38 |        160.66    |              4.2279  |
|       39 |        165.888   |              4.25354 |
|       40 |        171.142   |              4.27854 |
|       41 |        176.42    |              4.30293 |
|       42 |        181.723   |              4.32674 |
|       43 |        187.05    |              4.35    |
|       44 |        192.4     |              4.37273 |
|       45 |        197.773   |              4.39495 |
|       46 |        203.168   |              4.41669 |
|       47 |        208.584   |              4.43796 |
|       48 |        214.022   |              4.4588  |
|       49 |        219.481   |              4.47921 |
|       50 |        224.96    |              4.49921 |
|       51 |        230.459   |              4.51881 |
|       52 |        235.978   |              4.53804 |
|       53 |        241.516   |              4.55691 |
|       54 |        247.073   |              4.57543 |
|       55 |        252.649   |              4.59361 |
|       56 |        258.242   |              4.61147 |
|       57 |        263.854   |              4.62901 |
|       58 |        269.483   |              4.64625 |
|       59 |        275.129   |              4.6632  |
|       60 |        280.792   |              4.67987 |
|       61 |        286.472   |              4.69626 |
|       62 |        292.168   |              4.71239 |
|       63 |        297.881   |              4.72827 |
|       64 |        303.609   |              4.74389 |
|       65 |        309.353   |              4.75928 |
|       66 |        315.112   |              4.77443 |
|       67 |        320.887   |              4.78935 |
|       68 |        326.676   |              4.80406 |
|       69 |        332.48    |              4.81855 |
|       70 |        338.299   |              4.83284 |
|       71 |        344.131   |              4.84692 |
|       72 |        349.978   |              4.86081 |
|       73 |        355.839   |              4.87451 |
|       74 |        361.714   |              4.88802 |
|       75 |        367.602   |              4.90136 |
|       76 |        373.503   |              4.91451 |
|       77 |        379.418   |              4.9275  |
|       78 |        385.345   |              4.94032 |
|       79 |        391.285   |              4.95298 |
|       80 |        397.238   |              4.96548 |
|       81 |        403.204   |              4.97782 |
|       82 |        409.182   |              4.99002 |
|       83 |        415.172   |              5.00207 |
|       84 |        421.174   |              5.01397 |
|       85 |        427.188   |              5.02574 |
|       86 |        433.213   |              5.03737 |
|       87 |        439.251   |              5.04886 |
|       88 |        445.3     |              5.06022 |
|       89 |        451.36    |              5.07146 |
|       90 |        457.431   |              5.08257 |
|       91 |        463.514   |              5.09356 |
|       92 |        469.607   |              5.10443 |
|       93 |        475.712   |              5.11518 |
|       94 |        481.827   |              5.12582 |
|       95 |        487.953   |              5.13635 |
|       96 |        494.089   |              5.14676 |
|       97 |        500.236   |              5.15707 |
|       98 |        506.393   |              5.16728 |
|       99 |        512.56    |              5.17738 |
|      100 |        518.738   |              5.18738 |
|      105 |        549.773   |              5.23593 |
|      110 |        581.046   |              5.28223 |
|      115 |        612.546   |              5.32649 |
|      120 |        644.264   |              5.36887 |
|      125 |        676.191   |              5.40952 |
|      130 |        708.317   |              5.44859 |
|      135 |        740.636   |              5.48619 |
|      140 |        773.14    |              5.52243 |
|      145 |        805.822   |              5.55739 |
|      150 |        838.677   |              5.59118 |
|      155 |        871.699   |              5.62386 |
|      160 |        904.882   |              5.65551 |
|      165 |        938.221   |              5.68619 |
|      170 |        971.712   |              5.71595 |
|      175 |       1005.35    |              5.74486 |
|      180 |       1039.13    |              5.77295 |
|      185 |       1073.05    |              5.80027 |
|      190 |       1107.11    |              5.82687 |
|      195 |       1141.29    |              5.85278 |
|      200 |       1175.61    |              5.87803 |
|      210 |       1244.61    |              5.9267  |
|      220 |       1314.09    |              5.97311 |
|      230 |       1384.02    |              6.01747 |
|      240 |       1454.38    |              6.05994 |
|      250 |       1525.17    |              6.10068 |
|      260 |       1596.35    |              6.13982 |
|      270 |       1667.92    |              6.17749 |
|      280 |       1739.86    |              6.21379 |
|      290 |       1812.16    |              6.24882 |
|      300 |       1884.8     |              6.28266 |
|      310 |       1957.77    |              6.3154  |
|      320 |       2031.07    |              6.3471  |
|      330 |       2104.68    |              6.37782 |
|      340 |       2178.59    |              6.40763 |
|      350 |       2252.8     |              6.43658 |
|      360 |       2327.29    |              6.46471 |
|      370 |       2402.07    |              6.49207 |
|      380 |       2477.11    |              6.5187  |
|      390 |       2552.41    |              6.54464 |
|      400 |       2627.97    |              6.56993 |
|      410 |       2703.78    |              6.59459 |
|      420 |       2779.84    |              6.61866 |
|      430 |       2856.13    |              6.64216 |
|      440 |       2932.66    |              6.66513 |
|      450 |       3009.41    |              6.68757 |
|      460 |       3086.38    |              6.70953 |
|      470 |       3163.58    |              6.73101 |
|      480 |       3240.98    |              6.75204 |
|      490 |       3318.59    |              6.77264 |
|      500 |       3396.41    |              6.79282 |
|      550 |       3788.42    |              6.88804 |
|      600 |       4184.99    |              6.97498 |
|      650 |       4585.72    |              7.05496 |
|      700 |       4990.31    |              7.12901 |
|      750 |       5398.47    |              7.19796 |
|      800 |       5809.96    |              7.26245 |
|      850 |       6224.58    |              7.32304 |
|      900 |       6642.15    |              7.38017 |
|      950 |       7062.49    |              7.4342  |
|     1000 |       7485.47    |              7.48547 |

```python
from sympy import S

print(float(S.EulerGamma))
```

0.5772156649015329

```python
from sympy import harmonic, log, S
import tabulate

rk = [ 1,2,3,4,5,7, 10,20,30,50, 100,200,500, 1000,3000 ]
f = lambda k: k * harmonic(k)
f1 = lambda k: k * log(k)
f2 = lambda k: k * log(k) + S.EulerGamma * k
f3 = lambda k: k * log(k) + S.EulerGamma * k + 1/2
e = lambda g, k: g(k) - f(k)
table = [ [ k, f(k), e(f1,k), e(f2,k), e(f3,k), ] for k in rk ]
headers = [ '種類数(k)', '全種類揃う回数の期待値(E)', '近似1項まで誤差(E1-E)', '近似2項まで誤差(E2-E)', '近似3項まで誤差(E3-E)' ]
print(tabulate.tabulate( table, headers, tablefmt="pipe" ))
```
|   種類数(k) |   全種類揃う回数の期待値(E) |   近似1項まで誤差(E1-E) |   近似2項まで誤差(E2-E) |   近似3項まで誤差(E3-E) |
|---------:|-----------------:|-----------------:|-----------------:|-----------------:|
|        1 |          1       |         -1       |        -0.422784 |      0.0772157   |
|        2 |          3       |         -1.61371 |        -0.459274 |      0.0407257   |
|        3 |          5.5     |         -2.20416 |        -0.472516 |      0.0274839   |
|        4 |          8.33333 |         -2.78816 |        -0.479293 |      0.0207068   |
|        5 |         11.4167  |         -3.36948 |        -0.483399 |      0.0166012   |
|        7 |         18.15    |         -4.52863 |        -0.488119 |      0.0118807   |
|       10 |         29.2897  |         -6.26383 |        -0.491675 |      0.00832504  |
|       20 |         71.9548  |        -12.0401  |        -0.495834 |      0.00416563  |
|       30 |        119.85    |        -17.8137  |        -0.497223 |      0.00277747  |
|       50 |        224.96    |        -29.3591  |        -0.498333 |      0.0016666   |
|      100 |        518.738   |        -58.2207  |        -0.499167 |      0.000833325 |
|      200 |       1175.61    |       -115.943   |        -0.499583 |      0.000416666 |
|      500 |       3396.41    |       -289.108   |        -0.499833 |      0.000166667 |
|     1000 |       7485.47    |       -577.716   |        -0.499917 |      8.33333e-05 |
|     3000 |      25751.2     |      -1732.15    |        -0.499972 |      2.77778e-05 |
